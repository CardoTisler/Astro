<%- include("../partials/header") %>

<div>
    <div id="recipe-header-info">
        <h1><%= recipe.name %></h1>
        <h3><%= recipe.description %></h3>
    </div>

    <div id="recipe-body">
        <div id="recipe-img" class="mb-5" style="border-bottom: 1px solid rgba(0, 0, 0, 0.1)">
            <img class="rounded mx-auto d-block img-fluid mb-4" src="<%=recipe.image%>">
        </div>
        
        <div id="ingredients" style="border-bottom: 1px solid rgba(0, 0, 0, 0.1)">
            <ul class="list-group col-5 mb-5">
                <% recipe.ingredients.forEach(function(ingredient){  %>
                    <li class="list-group-item"> <%= ingredient %> </li>
                <% }) %>
            </ul>
        </div>
        
        <div id="directions" style="border-bottom: 1px solid rgba(0, 0, 0, 0.1)">
            <p class="mt-3"><strong>Directions</strong></p>
            <p class="mt-1"><strong>Cooking time: <%= recipe.cookingTime %> minutes.</strong></p>
            <div id="directions-text-area" class="col-7">
                <p><%=recipe.steps%></p>
            </div>
        </div>
        
        <% if(currentUser && recipe.author.id.equals(currentUser._id)){ %>
            <div id="authorized-buttons" class="mt-3 form-inline">
                <form class="form-inline" method="GET" action="/recipes/<%=recipe.id%>/edit">
                    <button class="btn btn-secondary">Edit recipe</button>
                </form>
        
                <form class="form-inline" method="POST" action="/recipes/<%=recipe.id%>?_method=DELETE">
                    <button class="btn btn-outline-danger">Delete recipe</button>
                </form>
            </div>
        <% } %>


        <div class="row bootstrap snippets">
            <div class="col-md-9 col-md-offset-2 col-sm-12">
                <div class="comment-wrapper">
                    <div class="card">
                        <div class="card-header">
                            Comments section
                        </div>
                        <div class="card-body">
                            <form method="POST" action="/recipes/<%=recipe.id%>/comments/new">
                                <textarea type="text" name="text" placeholder="write a comment..." class="form-control" rows="3"></textarea>
                                <button class="btn btn-info pull-right">Post</button>
                            </form>
                            
                            <div class="clearfix"></div>
                            <hr>
                            <ul class="media-list">
                                <!--  -->
                                <% recipe.comments.forEach(function(comment){ %>
                                    <li class="media">

                                        <div class="media-body">
                                            <span class="text-muted pull-right">
                                                <small class="text-muted"> TIMESTAMPHERE</small>
                                            </span>

                                            <strong class="text-success">@<%=comment.author.username%></strong>
                                            <p><%= comment.text %></p>

                                            <% if(currentUser && comment.author.id.equals(currentUser._id)){ %>
                                                <div class="form-inline">
                                                    <form method="GET" action="/recipes/<%=recipe.id%>/comment/<%=comment.id%>/edit"> 
                                                        <button class="btn btn-sm btn-outline-secondary">Edit comment</button> 
                                                    </form>
                                            
                                                    <form method="POST" action="/recipes/<%=recipe.id%>/comment/<%=comment.id%>?_method=DELETE">
                                                        <button class="btn btn-sm btn-outline-danger">Delete comment</button>
                                                    </form>
                                                </div>
                                            <% } %>
                                        </div>
                                    </li>
                                <% }) %>
                            
                            </ul>
                        </div>
                    </div>
                </div>
        
            </div>
        </div>
    </div>

</div>




<%- include("../partials/footer") %>